name: Build for Unix

on: [push, pull_request]

jobs:
  linux:
    name: Build (${{ matrix.os }}) - ${{ matrix.conf }}
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-16.04, ubuntu-18.04, ubuntu-20.04]
        conf: [Debug, Release]
      fail-fast: false

    steps:
    # Step building the core upnplib
      - uses: actions/checkout@v2

      - name: Configure core upnplib
        run: cmake -S . -B build -D CMAKE_BUILD_TYPE=${{ matrix.conf }}
#          -D GOOGLETEST=ON
#          -D BUILD_TESTING=OFF
#          -D client=OFF
#          -D device=OFF
#          -D gena=OFF
#          -D ipv6=OFF
#          -D optssdp=OFF
#          -D samples=OFF
#          -D scriptsupport=OFF
#          -D soap=OFF
#          -D ssdp=OFF
#          -D tools=OFF

      - name: Build
        run: cmake --build build

    # Step building core upnplib with GoogleTest
      - uses: actions/checkout@v2

      - name: Configure core upnplib with GoogleTest
        run: >
          cmake
          -S .
          -B build
          -D CMAKE_BUILD_TYPE=${{ matrix.conf }}
          -D GOOGLETEST=ON

      - name: Build
        run: cmake --build build

  macos:
    name: Build (${{ matrix.os }}) - ${{ matrix.conf }}
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [macos-latest] # macos-10.15, macos-11.0
        conf: [Debug, Release]
      fail-fast: false

    steps:
    # Step building the core upnplib
      - uses: actions/checkout@v2

      - name: Install build tools
        run: brew install pkg-config cmake ninja

      - name: Configure
        run: >
          cmake
          -G Ninja
          -S .
          -B build
          -D CMAKE_BUILD_TYPE=${{ matrix.conf }}

      - name: Build
        run: cmake --build build

    # Step building the core upnplib with GoogleTest
      - uses: actions/checkout@v2

      - name: Install build tools
        run: brew install pkg-config cmake ninja

      - name: Configure
        run: >
          cmake
          -G Ninja
          -S .
          -B build
          -D CMAKE_BUILD_TYPE=${{ matrix.conf }}
          -D GOOGLETEST=ON

      - name: Build
        run: cmake --build build
