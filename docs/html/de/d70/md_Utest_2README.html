<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UPnPlib: Use shared libraries</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">UPnPlib<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">&#39;Universal Plug and Play plus&#39; System Developement Kit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Use shared libraries</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md12"></a>By default Googletest builds static libraries and suggest to use them to be portable. On the other side Googletest strongly recommend to build its libraries together with the project to have the same environment and chaintools and avoid possible compatibillity problems. Having Googletest as part of the project you can run the Unit-Tests only on the installed project. So you can use its shared libraries without additional limitations because they point also to the installed project. Here is a compare of file sizes from 5 Unit Tests:</p>
<h2><a class="anchor" id="autotoc_md13"></a>
linked with static gtest/gmock libraries</h2>
<pre class="fragment">-rwxr-xr-x 1 ingo ingo  957704 2021-08-21 16:24 build/test_template
-rwxr-xr-x 1 ingo ingo 1138496 2021-08-21 16:24 build/test_threadutil
-rwxr-xr-x 1 ingo ingo 1672400 2021-08-21 16:24 build/test_upnpapi
-rwxr-xr-x 1 ingo ingo 1419864 2021-08-21 16:24 build/test_upnpdebug
-rwxr-xr-x 1 ingo ingo 1002416 2021-08-21 16:23 build/test_upnpdebug_nomock
</pre> <h2><a class="anchor" id="autotoc_md14"></a>
linked with shared gtest/gmock libraries</h2>
<pre class="fragment">-rwxr-xr-x 1 ingo ingo  26936 2021-08-22 02:10 build/test_template
-rwxr-xr-x 1 ingo ingo 205136 2021-08-22 02:10 build/test_threadutil
-rwxr-xr-x 1 ingo ingo 504832 2021-08-22 02:10 build/test_upnpapi
-rwxr-xr-x 1 ingo ingo 248144 2021-08-22 02:10 build/test_upnpdebug
-rwxr-xr-x 1 ingo ingo  92536 2021-08-22 02:10 build/test_upnpdebug_nomock
</pre><p> Each file is expanded with about 1 MB of the static Googletest code. Because I plan to use a lot of Unit Tests sharing the Googletest code seems to be a good idea.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Skip tests on Github Workflow Actions</h1>
<p>It is possible that you have tests which are failing because fixing the bug it is showing takes some time. To be able to push bug fixes and create pull requests you can skip tests if they run on the Github Workflow as Action. The test checks if the environment variable <code>GITHUB_ACTIONS</code> exists and will then skip the test. An example for this conditional check you can find in the test_template.cpp. If you want to see what tests are skipped on Github Actions you can execute the test for example with: </p><pre class="fragment">~$ GITHUB_ACTIONS=true ./build/Utest/test_template
</pre><p> To run all tests local from the projects root directory with GITHUB_ACTIONS I use: </p><pre class="fragment">~$ (cd ./build &amp;&amp; GITHUB_ACTIONS=true ctest --timeout 2 --output-on-failure)
</pre> <h1><a class="anchor" id="autotoc_md16"></a>
Find different unique values</h1>
<p>There are some values that must be unique system wide. To find all used values here are some pattern using grep.</p>
<p>All error messages have a unique nummber so the number does not only specify the associated message text but also its location in the source code. This also means that messages with the same text but a different location in the source have different numbers. Or with other words, each message have a unique index number, no matter what it is meaning. By default the message numbers start with</p><ol type="1">
<li>Numbers below are reservered for special use. You can find already used message numbers with: <pre class="fragment">~$ # Get used error message numbers
~$ grep -Pnor --color=never --exclude-dir={build,html,} --include='*.[chi]*' '...MSG\d\d\d\d...' | sort -t: -k3.4
</pre> To avoid conflicts with double used socket file descriptors (sfd) on tests I always use a new one. To have a simple search pattern I define a constant <code>umock::sfd_base</code> and set a new socket file descriptor for testing for example with 'umock::sfd_base + 1' so I can simply grep for 'sfd_base' to find already used ones.</li>
</ol>
<p>IMPORTANT! There is a limit FD_SETSIZE = 1024 for socket file descriptors that can be used with 'select()'. We must not use more than 1023 fds. Otherwise we have undefined behavior and may get segfaults with 'FD_SET()'. For details have a look at 'man select'.</p>
<p>To find all used file descriptors in tests I use this command: </p><pre class="fragment">~$ # Get used file descriptors
~$ grep -Pnor --color=never --include='*.[chi]*' 'sfd_base \+ \d+ *\+* *\d*' ./Utest | sort -t: -k3.12n
</pre><p> It is also strongly recommended to use unique port numbers for testing to avoid getting a delay to re-use an ip address. I start with test port number 50000 -and use a simple search that does not necessarily find only used port nummbers. -But it doesn't matter as long as the new used number isn't found. I use this: </p><pre class="fragment">~$ # Get used port numbers
~$ grep -Phor --include='*.[chi]*' '5\d\d\d\d' ./Utest | sort -n | uniq
</pre><p> <br  />
</p><pre>
// Copyright (C) 2021 GPL 3 and higher by Ingo HÃ¶ft,  &amp;#60;Ingo&amp;#64;Hoeft-online.de&amp;#62;
// Redistribution only with this Copyright remark. Last modified: 2024-04-21
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
