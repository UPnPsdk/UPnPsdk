<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UPnPsdk: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">UPnPsdk<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">Universal Plug and Play +, Software Development Kit</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>The UPnP+™ Software Development Kit</b><br  />
General information to the SDK, its structure and requirements.</p>
<hr  />
<h1><a class="anchor" id="parts"></a>
Parts 'Control Point' and 'UPnP Device'</h1>
<p>The SDK has two parts, handling Control Points or UPnP Devices. They are largely independent of each other. You can compile both parts separately so you have resulting libraries that only handle Control Points or UPnP Devices. That make sense for installations that are only a Control Point or only a UPnP Device and is of particular interest for embedded devices. Of course you can also have both parts for hybrid applications.</p>
<h1><a class="anchor" id="overview_comp"></a>
Main Components</h1>
<p>The <b>S</b>oftware <b>D</b>evelopment <b>K</b>it contains some main components that are associated with a specific step of the <a href="UPnP-arch-DeviceArchitecture-v2.0-20200417.pdf">UPnP™ Device Architecture 2.0</a>.<br  />
 These components are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">order   </th><th class="markdownTableHeadNone">component   </th><th class="markdownTableHeadNone">part of    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyNone">miniserver   </td><td class="markdownTableBodyNone">Step 0: Addressing    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">2   </td><td class="markdownTableBodyNone">webserver   </td><td class="markdownTableBodyNone">Step 1: Discovery    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">3   </td><td class="markdownTableBodyNone">SSDP   </td><td class="markdownTableBodyNone">Step 1: Discovery    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">4   </td><td class="markdownTableBodyNone">SOAP   </td><td class="markdownTableBodyNone">Step 3: Control    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">5   </td><td class="markdownTableBodyNone">GENA   </td><td class="markdownTableBodyNone">Step 4: Eventing   </td></tr>
</table>
<p>The order shows the dependency. Each component depends on its predecessor. For example if selecting SSDP on configuring to compile, this selects also automatically the webserver (only that) and the webserver selects miniserver. If you select GENA for compiling you have a full featured configuration with all main components. There is no need to select previous moduls. Also the abstraction will increase with the order. For example no component except miniserver will handle network sockets.</p>
<dl class="section note"><dt>Note</dt><dd>This order is an important implicit dependency. It is always expected that it is respected. No internal checks are made about this. The compiler will remind you if you forget it.</dd></dl>
<h1><a class="anchor" id="noexcept"></a>
Promise to throw "no exception"</h1>
<p>There are several functions and methods that are specified to <a href="https://en.cppreference.com/w/cpp/language/noexcept_spec">noexcept</a>. This may not always be true with debugging or TRACE enabled because there we have extended use of std::string objects for output to std::cerr. Both may throw exceptions in rare cases like exceeding max. length of a std::string or error on memory allocation or modified output flags of the std::cerr output stream by the program using the SDK. The result of such an unexpected exception is the immediate termination of the program as specified for <b>noexcept</b>. But I assume that debugging or TRACE is only a temporary setting not used for production code and is under special observation by the developer so that he can evaluate these exceptions.</p>
<h1><a class="anchor" id="overview_reuseaddr"></a>
Socket option "reuse address"</h1>
<p>There is an issue when a network connection unexpectedly dies. The port then has normaly to <code>TIME_WAIT</code> util it can use its old <a class="el" href="d5/d67/Glossary.html#glossary_netaddr">netaddress</a> again. This may not be acceptable for certain server applications. So there is a socket option <code>SO_REUSEADDR</code> to immediately reuse a given netaddress, but with the risk of network errors and security issues. For more details have a look at <a href="https://hea-www.harvard.edu/~fine/Tech/addrinuse.html">Bind: Address Already in Use</a>.</p>
<p>I don't set the option to immediately reuse an address of a local connected socket after the connection closed unexpectedly. Instead I respect the <code>TIME_WAIT</code>. For an immediate reconnection I use a new address. A new <a class="el" href="d5/d67/Glossary.html#glossary_netaddr">netaddress</a> is already given with a changed port so I just use the same ip address with another port. I always reset socket option <code>SO_REUSEADDR</code> with constructing a socket object on all platforms.</p>
<p>A TIME_WAIT is not necessary if the remote control point closes the connection. <a class="el" href="dd/d67/namespaceUPnPsdk.html" title="Reengineered Object Oriented UPnP+ program code.">UPnPsdk</a> uses the protocol to signal the remote control point to shutdown the connection if it support it.</p>
<p>This is unclear on Microsoft Windows. <b>THERE WE HAVE AN IMPORTANT SECURITY ISSUE!</b><br  />
In the past Windows had a very bad network security on low level socket handling as documented at <a href="https://learn.microsoft.com/en-us/windows/win32/winsock/using-so-reuseaddr-and-so-exclusiveaddruse">Using SO_REUSEADDR and SO_EXCLUSIVEADDRUSE</a>. Microsoft has fixed this since Windows Server 2003. The network stack now behaves like it does by default on other platforms. Strangely, they call it advanced security, which is standard on other major operating systems. But this isn't done by default. The developer has to take this into account by using the socket option SO_EXCLUSIVEADDRUSE. I always set this option with constructing a socket object on a WIN32 platform.</p>
<h1><a class="anchor" id="overview_lfs"></a>
LFS: Large-File Support</h1>
<p>For embedded devices 32 bit architectures are still supported. Only for this architectures Large-file support is needed to handle files greater 2 GiB. We need this because we have to handle video files that may exceed this limit. <b>For targets with 64 bit architecture LFS is not relevant.</b></p>
<p>The problem is the access to files. The natural limit is given by the address structure. With 32 bit you can access max. 2 GiB, with 64 bit architectures you can access usually 256 terabytes for example with <code>fseek</code>. To handle large files with 32 bit you have to provide new functions, e.g. <code>fseek64</code>. Microsoft Windows is going this way and provides <code>fseek</code> and <code>_fseeki64</code>. POSIX is going an other way. It provides <code>fseeko()</code> and <code>ftello()</code> functions that are identical to <code>fseek()</code> and <code>ftell()</code>, respectively, except that the offset argument of <code>fseeko()</code> and the return value of <code>ftello()</code> is of type off_t instead of long. On some architectures, both off_t and long are 32-bit types, but defining <code>_FILE_OFFSET_BITS=64</code> as compile option will turn off_t into a 64-bit type. This way you can compile your code to use LFS or not without modifications. </p><dl class="section note"><dt>Note</dt><dd><b><a class="el" href="dd/d67/namespaceUPnPsdk.html" title="Reengineered Object Oriented UPnP+ program code.">UPnPsdk</a></b> always supports large files and the application using the SDK MUST also do it to avoid a program crash due to different pointer sizes. If you try to compile for a 32 bit application without LFS you will get a compile error telling you to enable LFS for your application.</dd></dl>
<p><b>References:</b> </p><ul>
<li>Wikipedia <a href="https://en.wikipedia.org/wiki/Large-file_support">Large-file support</a></li>
<li>Summary of LFS preprocessor marcros <a href="https://stackoverflow.com/questions/14184031/what-is-the-difference-between-largefile-source-and-file-offset-bits-64">What is the difference between _LARGEFILE_SOURCE and _FILE_OFFSET_BITS=64?</a></li>
<li>Example for a test of Large-file <a href="https://stackoverflow.com/questions/61339678/ac-sys-largefile-with-cmake">AC_SYS_LARGEFILE with CMake</a></li>
<li>To understand the problems here are some <a href="https://github.com/pupnp/pupnp/issues?q=largefile">relevant issues</a></li>
</ul>
<h1><a class="anchor" id="overview_visibility"></a>
Visibility support</h1>
<p>Visibility Support provides a powerful optimization. I use it as described at the <a href="https://gcc.gnu.org/wiki/Visibility">GCC Wiki - Visibility</a>. It only belongs to shared libraries. Here in short the needed steps configured for this software development kit:</p>
<ul>
<li>Enable Visibility Support with CMake on the whole project: <div class="fragment"><div class="line">set(CMAKE_CXX_VISIBILITY_PRESET hidden)</div>
<div class="line">set(CMAKE_VISIBILITY_INLINES_HIDDEN 1)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># or only on a target:</span></div>
<div class="line">set_target_properties(UPnPsdk_shared PROPERTIES</div>
<div class="line">CXX_VISIBILITY_PRESET hidden</div>
<div class="line">VISIBILITY_INLINES_HIDDEN ON)</div>
</div><!-- fragment --> <br  />
</li>
<li>When building a shared library set its compile definitions to <code>UPnPsdk_SHARE</code> and <code>UPnPsdk_EXPORTS</code>. You should declare <code>UPnPsdk_SHARE</code> to be <b>PUBLIC</b>. With nested use of libraries this is only needed for the first library. CMake propagates the compile definition. With other combinations you have to respect CMakes propagation rules for PRIVATE, PUBLIC, INTERFACE and it may be necessary to also declare <code>UPnPsdk_SHARE</code> on following libraries and executables. In result every shared library and executable using it, must see <code>UPnPsdk_SHARE</code>.</li>
</ul>
<p>Never set <code>UPnPsdk_EXPORTS</code> to PUBLIC. This may see an executable target that should not export symbols. </p><div class="fragment"><div class="line">add_library(UPnPsdk_shared SHARED</div>
<div class="line">        ${UPnPsdk_SOURCE_FILES})</div>
<div class="line">target_compile_definitions(UPnPsdk_shared</div>
<div class="line">        PUBLIC UPnPsdk_SHARE</div>
<div class="line">        PRIVATE UPnPsdk_EXPORTS)</div>
<div class="line"> </div>
<div class="line">add_library(compa_shared SHARED</div>
<div class="line">        ${COMPA_SOURCE_FILES})</div>
<div class="line">target_compile_definitions(compa_shared</div>
<div class="line">        PRIVATE UPnPsdk_EXPORTS)</div>
<div class="line">target_link_libraries(compa_shared</div>
<div class="line">        PUBLIC UPnPsdk_shared)</div>
<div class="line"> </div>
<div class="line">add_executable(api_calls-csh</div>
<div class="line">        ${API_CALLS_SOURCE_FILES})</div>
<div class="line">target_link_libraries(api_calls-csh</div>
<div class="line">        PRIVATE compa_shared)</div>
</div><!-- fragment --><p> But you need with: </p><div class="fragment"><div class="line">target_link_libraries(compa_shared</div>
<div class="line">        PRIVATE UPnPsdk_shared)</div>
<div class="line"> </div>
<div class="line">add_executable(api_calls-csh</div>
<div class="line">        ${API_CALLS_SOURCE_FILES})</div>
<div class="line">target_compile_definitions(api_calls-csh</div>
<div class="line">        PRIVATE UPnPsdk_SHARE)</div>
<div class="line">target_link_libraries(api_calls-csh</div>
<div class="line">        PRIVATE compa_shared)</div>
</div><!-- fragment --><p> <br  />
</p><ul>
<li>In your header files, wherever you want an interface or API made public outside the current Dynamic Shared Object, place <code>UPnPsdk_API</code> in struct, class and function declarations you wish to make public. You should not specify it in the definition of your source files. On Microsoft Windows Visual Studio it does not compile due to an error. You should never do it on templated or static functions because they are defined to be local. <div class="fragment"><div class="line"><a class="code hl_define" href="d0/d21/visibility_8hpp.html#a4d2eaa20d58e8671ac73f5fdcd45dd98">UPnPsdk_API</a> <span class="keywordtype">int</span> PublicFreeFunc();</div>
<div class="line"><span class="keyword">class </span><a class="code hl_define" href="d0/d21/visibility_8hpp.html#a4d2eaa20d58e8671ac73f5fdcd45dd98">UPnPsdk_API</a> PublicClass{};</div>
<div class="line"><span class="keyword">struct </span><a class="code hl_define" href="d0/d21/visibility_8hpp.html#a4d2eaa20d58e8671ac73f5fdcd45dd98">UPnPsdk_API</a> PublicStruct{};</div>
<div class="ttc" id="avisibility_8hpp_html_a4d2eaa20d58e8671ac73f5fdcd45dd98"><div class="ttname"><a href="d0/d21/visibility_8hpp.html#a4d2eaa20d58e8671ac73f5fdcd45dd98">UPnPsdk_API</a></div><div class="ttdeci">#define UPnPsdk_API</div><div class="ttdoc">Prefix to export symbol for external use.</div><div class="ttdef"><b>Definition</b> <a href="d0/d21/visibility_8hpp_source.html#l00061">visibility.hpp:61</a></div></div>
</div><!-- fragment --> <br  />
</li>
<li>For optimization with using <code>UPnPsdk_LOCAL</code> look at the <a href="https://gcc.gnu.org/wiki/Visibility">GCC Wiki - Visibility</a>. If you have a publicy visibile <code>class UPnPsdk_API PublicClass()</code> then all its member functions are also publicy visible. To keep them private you can prefix them with <code>UPnPsdk_LOCAL</code>. </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
